meta {
  name: JWT Token Implementation Tests
  type: http
  seq: 1
}

### 1. Register User Test
post {
  url: http://localhost:9000/api/auth/register
  body: json
  auth: none
}

body:json {
  {
    "username": "testuser",
    "email": "testuser@example.com",
    "password": "password123",
    "role": "SELLER"
  }
}

### 2. Login Test (Enhanced Response)
post {
  url: http://localhost:9000/api/auth/login
  body: json
  auth: none
}

body:json {
  {
    "usernameOrEmail": "testuser@example.com",
    "password": "password123"
  }
}

### 3. Refresh Token Test
post {
  url: http://localhost:9000/api/auth/refresh-token
  body: json
  auth: none
}

body:json {
  {
    "refreshToken": "{{refreshToken}}"
  }
}

### 4. Validate Token Test
post {
  url: http://localhost:9000/api/auth/validate-token
  body: none
  auth: bearer
}

auth:bearer {
  token: {{accessToken}}
}

### 5. Test Protected Endpoint with New Token
get {
  url: http://localhost:9000/api/users/profile
  body: none
  auth: bearer
}

auth:bearer {
  token: {{accessToken}}
}

### 6. Health Check
get {
  url: http://localhost:9000/api/auth/health
  body: none
  auth: none
}

### Expected Responses:

### Login Response Should Include:
# {
#   "timestamp": "2024-01-01T12:00:00",
#   "message": "Login successful",
#   "description": "You have been successfully authenticated...",
#   "data": {
#     "accessToken": "eyJhbGc...",
#     "refreshToken": "eyJhbGc...",
#     "tokenType": "Bearer",
#     "userId": 1,
#     "username": "testuser",
#     "email": "testuser@example.com",
#     "role": "SELLER",
#     "location": null,
#     "expiresAt": "2024-01-02T12:00:00",
#     "refreshExpiresAt": "2024-01-08T12:00:00",
#     "expiresIn": 86400,
#     "refreshExpiresIn": 604800
#   },
#   "success": true
# }

### Token Validation Response Should Include:
# {
#   "timestamp": "2024-01-01T12:00:00",
#   "message": "Token validation completed",
#   "description": "Token is valid and active",
#   "data": {
#     "valid": true,
#     "userDetails": {
#       "username": "testuser",
#       "userId": 1,
#       "email": "testuser@example.com",
#       "role": "SELLER",
#       "location": null,
#       "roles": ["ROLE_SELLER", "car:create", "car:update:own"],
#       "expiresAt": "2024-01-02T12:00:00",
#       "issuedAt": "2024-01-01T12:00:00"
#     }
#   },
#   "success": true
# }
